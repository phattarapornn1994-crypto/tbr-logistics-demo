generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  role      String   @default("planner")
  createdAt DateTime @default(now())
  routes    Route[]
}

model Customer {
  id          String       @id @default(cuid())
  name        String
  code        String?      @unique
  address     String?
  lat         Float?
  lng         Float?
  locations   Location[]
  createdAt   DateTime     @default(now())
}

model Location {
  id          String      @id @default(cuid())
  customerId  String?
  name        String
  address     String?
  lat         Float?
  lng         Float?
  customer    Customer?   @relation(fields: [customerId], references: [id])
  destinations Destination[]
}

model Vehicle {
  id           String    @id @default(cuid())
  code         String    @unique
  type         String
  capacityKg   Float?
  capacityM3   Float?
  active       Boolean   @default(true)
  routes       Route[]
}

model Route {
  id              String          @id @default(cuid())
  name            String
  driverName      String?
  vehicleId       String?
  createdById     String?
  optimizationId  String?
  scheduledDate   DateTime?
  status          String          @default("PLANNED")
  stops           Destination[]
  user            User?           @relation(fields: [createdById], references: [id])
  vehicle         Vehicle?        @relation(fields: [vehicleId], references: [id])
  optimization    OptimizationProfile? @relation(fields: [optimizationId], references: [id])
}

model Destination {
  id        String   @id @default(cuid())
  routeId   String?
  locationId String?
  sequence  Int
  eta       DateTime?
  notes     String?
  route     Route?    @relation(fields: [routeId], references: [id])
  location  Location? @relation(fields: [locationId], references: [id])
}

model Order {
  id           String   @id @default(cuid())
  customerId   String?
  locationId   String?
  routeId      String?
  refCode      String?
  volume       Float?
  weightKg     Float?
  status       String   @default("PENDING")
  customer     Customer? @relation(fields: [customerId], references: [id])
  location     Location? @relation(fields: [locationId], references: [id])
  route        Route?    @relation(fields: [routeId], references: [id])
}

model OptimizationProfile {
  id                String   @id @default(cuid())
  name              String
  description       String?
  maxHoursPerRoute  Float?
  maxStops          Int?
  preferHighVolume  Boolean  @default(true)
  serviceWindowRule String?
  createdAt         DateTime @default(now())
  routes            Route[]
}

model Scenario {
  id          String   @id @default(cuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
}

model Schedule {
  id        String   @id @default(cuid())
  routeId   String?
  startAt   DateTime?
  endAt     DateTime?
  route     Route?   @relation(fields: [routeId], references: [id])
}

model ActivityLog {
  id        String   @id @default(cuid())
  userId    String?
  action    String
  detail    String?
  createdAt DateTime @default(now())
}

model SystemSetting {
  id     String @id @default(cuid())
  key    String @unique
  value  String
}
